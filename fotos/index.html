<!DOCTYPE html>
<html>
<head>
<meta http-equiv='content-type' content='text/html;charset=utf-8' />
<title>Фотки / Сайт Григория Еремина</title>
<meta name="description" content="Подборка фотографий, снятых на телефон, о природе, местах, людях. "/>
<meta name="keywords" content="изображения, картинки, тексты, заметки, фото"/>
<link rel='shortcut icon' href='/static/img/favicon.ico?1322400151' />
<link rel='stylesheet' href='/static/css/main.css' />
<script src='/static/share42/share42.js'></script>
<script src='/static/js/updater.js'></script>
<script src='/static/js/main.js'></script>
<script src='/static/js/dbcartasvg.js'></script>
</head>
<body>
<script type='text/javascript'>

  addMetaTags( 'Фотки' );
  addBodyTags( 'fotos' );

  var dwchilds=[];

  var p = document.createElement('div');
  document.getElementById('page_header').appendChild(p);
  p.className = 'mtext hspace';
  p.style.padding = '10px 13px';
  p.appendChild(document.createTextNode('Подборка фото, снятых на телефон, о природе, местах, людях. '));
  p.innerHTML += new Array(20).join('&nbsp;');
  var el = document.createElement('select');
  el.id = 'albumlist';
  el.style.height = '40px';
  p.appendChild(el);

  var wrap = document.createElement('div');
  wrap.className = 'wrap';
  document.getElementById('page_content').appendChild(wrap);

  var mtab = document.createElement('table');
  mtab.style.width = '100%';
  var row = document.createElement('tr');
  mtab.appendChild(row);

  var col = document.createElement('td');
  col.colSpan = '10';
  col.id = 'mcol';
  col.style.padding = '0';
  col.style.verticalAlign = 'middle';
  row.appendChild(col);

  var col = document.createElement('td');
  col.width = '125px';
  col.style.padding = '0 0 0 1px';
  col.style.verticalAlign = 'top';
  row.appendChild(col);
  var md = document.createElement('div');
  col.appendChild(md);
  wrap.appendChild(mtab);

  md.style.height = (window.innerHeight - document.getElementById('header').offsetHeight - document.getElementById('footer').offsetHeight - 100) + 'px';
  md.style.overflow = 'auto';

    // fill list
  dw = new dbCartaSvg({
    id:'mcol',
    bg: 'transparent',
    sbarpos: 'left',
    height: md.offsetHeight
  });
    // img
  var img = new Image();
  img.onload = function() {
    for (var i=0; i<dwchilds.length; i++)
      dw.vp.removeChild(dwchilds[i]);
    dwchilds = [];
    var ratio = this.width/this.height,
      vs = dw.viewsizeOf();  // map sizes degrees
    var crds = [[-vs[1]*ratio,vs[1]],[-vs[3]*ratio,vs[3]]],
        pts = [dw.toPoints(crds[1]), dw.toPoints(crds[0])];
    var dwimg = dw.append('image', {
      width: pts[0][0]-pts[1][0], height: pts[0][1]-pts[1][1],
      x: pts[1][0], y: pts[1][1], preserveAspectRatio:'none'
    });
    dwimg.setAttributeNS('http://www.w3.org/1999/xlink', 'href', this.src);
    dw.attr(dwimg, { cursor: 'pointer' });
    dwchilds.push(dwimg);    
  }
  loadScript({url: '/fotos/index.js'}, function(p){
    var albumlist = document.getElementById('albumlist');
    for(var k in ALBUMS){
      var opt = document.createElement('option');
      opt.value = k;
      opt.appendChild(document.createTextNode(ALBUMS[k]));
      albumlist.onchange = function(){
        var urls = IMGURLS.filter(function(a){ return a[0] === albumlist.options[albumlist.selectedIndex].value; });
        md.innerHTML = '';
        for(var i in urls) {
          if (i==0) img.src = urls[i][1];
          var el = document.createElement('div');
          md.appendChild(el);
          el.id = 'img' + i;
          var im = document.createElement('img');
          im.style.padding = '1px 0';
          im.style.cursor = 'pointer';
          im.width = 100;
          im.alt = i;
          im.src = urls[i][1].replace('.jpg', '.th.jpg');
          im.title = urls[i][2];
          im.onclick = function(){ 
            img.src = this.src.replace('.th.jpg', '.jpg'); 
            img.title = this.title;
          }
          im.onload = function(){ document.getElementById('img' + this.alt).appendChild(this); }
        }
      }
      document.getElementById('albumlist').appendChild(opt);
    }
    albumlist.selectedIndex = IMGURLS[0][0];
    albumlist.onchange();
  });
  
</script>
</body>
</html>
