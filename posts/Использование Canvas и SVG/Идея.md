<!--2013-07-18 19:29:49-->
### Идея
Решил написать пост о популярном нынче <i>Canvas</i> из <i>HTML5</i> и о своем проекте <i>dbCartajs</i>, его использующем. Почему <i>Canvas</i>? Немного истории. Прежде для создания изображений, иллюстрирующих различные расчетные модели (например, вывод окружности по радиусу и центру в координатах, вывод многоугольника с количеством вершин N и площадью S, вывод окружности на сферу и т.д.), я и мои коллеги по работе в институте использовали различные элементы управления из разных сред разработки: <i>PictureBox</i> их <i>VB6</i>, <i>QPainter</i> и <i>QCanvas</i> из <i>Qt</i>, <i>Canvas</i> из <i>Tk</i> и, наконец, создание изображений по <i>mapfile</i> из <i>MapServer</i>. Позже после знакомства с возможностями <i>HTML5</i> я решил перейти на использование <i>Canvas</i> и <i>Web</i>-разработку с <i>JavaScript</i>. Удобно - для отладки и разработки нужен лишь браузер. Собравшись с силами и вооружившись документацией от <i>W3C</i>, я переписал часть функционала компонентов, которые мы используем в работе, на <i>JavaScript</i>, оформив это в проект <i>dbCartajs</i> на <i>GitHub</i>. Код реализован в виде объекта <i>dbCarta</i>, чтобы использовать его как виджет на страницах без копирования частей исходного кода.

![Скриншот виджета с <i>dbCarta</i>](http://img-fotki.yandex.ru/get/9064/136640652.0/0_b999b_feccc6d_L.jpg "Чемпионат Мира по футболу 2014 пройдет в Бразилии")
<br>
Виджет с <i>dbCarta</i>.

Собственно идейно <i>dbCartajs</i> портирован из проекта <i>dbCarta</i> на [googlecode](http://dbcarta.googlecode.com), реализованном на <i>Python</i> и <i>Tkinter</i>.

### Как это работает

<i>dbCartajs</i> использует <i>Canvas</i> для вывода объектов по координатам (долгота, широта в градусах) или пойнтам (points). В проект включена библиотека <i>Proj4js</i>, реализующая пересчеты картографических проекций. Из нее на использование настроены несколько проекций - это сферические <i>nsper</i>, <i>ortho</i>, <i>laea</i> и <i>меркатор</i> (как у популярного <i>Google Maps</i> - <i>Google Mercator</i>). По умолчанию используется холст с соотношением сторон ширина-высота 2:1, что соответствует плоской проекции <i>longlat</i> из <i>Proj4js</i>. Если <i>proj4js-combined.js</i> подгружен, то доступны другие проекции через интерфейсы <i>changeProject</i> или initProj объекта <i>dbCarta</i>.

Конечно, не все возможности <i>Canvas</i> реализованы в <i>dbCartajs</i>, но некоторым я постарался уделить внимание. Первое, это шрифты. При масштабировании они не меняются. Второе, это использование метода <i>isPointInPath</i>, позволяющего реализовать аналог использования элементов <i>MAP</i>, <i>AREA</i> и <i>IMG</i>. И третье, это возможность совмещения объектов из разных проекций. В демо StarrySky для вывода границ Земли, контуров материков используется сферическая проекция nsper, для вывода звезд, орбит космических аппаратов - плоская проекция <i>longlat</i>. Для смены проекций используются методы <i>initProj</i> (с указанием параметров проекции для <i>Proj4js</i>) или <i>changeProject</i> (без параметров).

![Скриншот с демо StarrySky](http://img-fotki.yandex.ru/get/9494/136640652.0/0_b9db5_bda38590_L.jpg "Совмещение проекций в StarrySky")
<br>
Совмещение проекций в <i>StarrySky</i>.

### Про управление

Перемещение по карте доступно по клику (по клику центрируется точка в пределах карты). Масштабирование карты осуществляется через интерфейс <i>scaleCarta</i> или по кнопкам <i>+/-</i>, расположенным справа. В сферических проекциях вращение глобуса осуществляется через интерфейс <i>initProj</i>.

### Где посмотреть

Примеры проекта можно посмотреть на сaйте [dbcartajs.appspot.com](http://dbcartajs.appspot.com). Исходники доступны в [GitHub](http://github.com/egaxegax/dbcartajs).