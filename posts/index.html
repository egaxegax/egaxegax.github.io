<!DOCTYPE html>
<html>
<head>
<meta http-equiv='content-type' content='text/html;charset=utf-8'>
<meta name='description' content='Заметки, цитаты, статьи и посты на самые разные темы.'>
<meta name='keywords' content='статьи, тексты, заметки, фото'>
<meta name='author' content='Grigoriy Eremin, Григорий Еремин, egax@bk.ru'>
<meta name='yandex-verification' content='bf07f0af8e739c66'>
<meta name='google-site-verification' content='eWwGSnvveM7GniusD-nYN2KXBDPtXBHmhKRezn_TBg8'>
<title>Заметки / Сайт Григория Еремина</title>
<link rel='shortcut icon' href='/favicon.ico'>
<link rel='stylesheet' href='/static/css/main.css'>
<link rel='stylesheet' href='/static/css/markdown.css'>
<script src='/static/js/updater.js'></script>
<script src='/static/js/3rdparty/showdown.min.js'></script>
<script src='/static/js/main.js'></script>
</head>
<body>
<script type='text/javascript'>

  document.body.innerHTML = addTemplate( 'posts' );
  document.getElementById('page_header').innerHTML = 
'<p class="mtext hspace">'+
  'Заметки, статьи, цитаты на самые разные темы.'+
'</p>';

  function addPost(r, p){
    var converter = new showdown.Converter(), // to markdown
        text = r
          .replace(/\/photos\//g, '/fotos/')
          .replace(/\r\r\n/g, '\n')
          .replace(/\r*\n>\r*\n*/g, '\n<p></p>\n')
          .replace(/\{: class=rounded :\}/g, ''),
        html = converter.makeHtml(text);
    var tmpl = 
  '<div class="msgtext">'+
    (p.title[2] !== 'about' ? 
  '<h3><a class="nodecor" href="?t='+ p.title[1] +'">'+p.title[2]+'</a></h3>'
    : '')+
    html+
  '</div>'+
    (p.title[2] !== 'about' ? 
  '<div class="msgfooter">'+
    '<a class="nodecor" href="?s='+p.title[0]+'">'+p.subj+'</a>'+
    '<div class="gray smaller"> '+buildDate(p.title[3])+'</div>'+
  '</div>' 
    : '');
    return tmpl;
  }

  loadScript({url: '/posts/index.js'}, function(p){
    var subjects = SUBJ,
        titles = TITLES;
    for(var p in urlParams()){
      if (p == 's') {
        titles = titles.filter(function(tit){ return (tit[0] == urlParams()[p]); });
        titles = [[titles[0][0],titles[0][1],'about','']].concat(titles); // +about page
        document.title += ' - ' + subjects[titles[0][0]][0];
      };
      if (p == 't') {
        titles = titles.filter(function(tit){ return (tit[1] == urlParams()[p]); });
        document.title += ' - ' + titles[0][2];
      }
    }
    var per_page = 10,
        page_num = urlParams().page||1,
        page_bottom = (page_num-1)*per_page,
        page_top = page_bottom+per_page;
    var page_titles = titles.slice(page_bottom, page_top);
    for(var i=0; i<page_titles.length; i++){
      var subj = subjects[ page_titles[i][0] ][0],
          title = page_titles[i][2];
      document.getElementById('page_content').innerHTML += 
    '<div id="post'+i+'">'+
      (i==0 ? '<img class="hspace1" src="/static/img/loader.gif">' : '')+
    '</div>';
      upfunc({id: 'post'+ i, subj: subj, title: page_titles[i], url: subj + '/' + title + '.txt'}, function(r,p,st){
        var wrap = document.getElementById(p.id);
        wrap.innerHTML = '';
        if(st == 200) { // skip Not Found pages
          var wrap = document.getElementById(p.id);
          wrap.className = 'wrap';
          wrap.innerHTML = addPost(r, p);
            // add description meta
          if(p.id == 'post0'){
            var meta = document.head.getElementsByTagName('meta');
            for(var j in meta){
              if(meta[j].name == 'description') meta[j].content = wrap.innerHTML.replace(/(<([^>]+)>)/gi, '');
            }
          }
        }
      });
    }
    if (page_titles.length){
      document.getElementById('page_content').innerHTML += 
    '<p class="mtext hspace">'+
      '<a href="/posts/subj.html">Все темы</a>'+
    '</p>';
      document.getElementById('page_footer').innerHTML = addPaginator(titles, per_page, page_num);
    } else {
      document.getElementById('page_content').innerHTML += 
    '<p class="mtext hspace">'+
      'Нет данных.'+
    '</p>'+
    '<img src="/static/img/confuse.png" width="120px">';
    }
  });

</script>
<script src='https://www.googletagmanager.com/gtag/js?id=UA-25857345-4'></script>
<script src='/static/js/metrics.js'></script>
</body>
</html>
